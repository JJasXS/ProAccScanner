@page
@model FirebirdWeb.Pages.LoginModel
@{
    ViewData["Title"] = "Login";
}

<h2>Login with OTP</h2>

<div>
    <label>Email:</label>
    <input type="email" id="email" />
    <button id="sendBtn">Send OTP</button>
</div>

<div id="otpGroup" style="display:none; margin-top:10px;">
    <label>Enter OTP:</label>
    <input type="text" id="otp" />
    <button id="verifyBtn">Verify OTP</button>
</div>

<div id="message" style="margin-top:10px; color:blue;"></div>

<script>
document.getElementById('sendBtn').addEventListener('click', async () => {
    const email = document.getElementById('email').value;
    const formData = new FormData();
    formData.append('Email', email);

    const res = await fetch('@Url.Page("Login", "SendOTP")', {
        method: 'POST',
        body: formData
    });

    const data = await res.json();
    document.getElementById('message').innerText = data.message;

    if (data.success) {
        document.getElementById('otpGroup').style.display = 'block';
    }
});

document.getElementById('verifyBtn').addEventListener('click', async () => {
    const email = document.getElementById('email').value;
    const otp = document.getElementById('otp').value;
    const formData = new FormData();
    formData.append('Email', email);
    formData.append('OTP', otp);

    const res = await fetch('@Url.Page("Login", "VerifyOTP")', {
        method: 'POST',
        body: formData
    });

    const data = await res.json();
    document.getElementById('message').innerText = data.message;
});
</script>
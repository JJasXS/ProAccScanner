@page
@model FirebirdWeb.Pages.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
}

<link rel="stylesheet" href="~/css/dashboard.css" />

<div class="dashboard-page">

    <!-- ✅ Top bar with hamburger -->
    <div class="top-row">
        <button id="menuBtn" class="hamburger-btn" type="button" aria-label="Menu">
            ☰
        </button>
        <div class="top-title">Dashboard</div>
    </div>

    <!-- ✅ Welcome row -->
    <div class="welcome-row">
        <div class="welcome-text">
            Welcome, <span class="welcome-name">@Model.UserName</span>
        </div>
     
    </div>

    <!-- ✅ Slide menu -->
    <div id="menuOverlay" class="menu-overlay"></div>

    <div id="sideMenu" class="side-menu">
        <div class="side-menu-header">
            <div class="side-menu-title">Menu</div>
            <button id="closeMenuBtn" class="side-menu-close" type="button" aria-label="Close">
                ✕
            </button>
        </div>

        <!-- show user in menu too -->
        <div class="side-user">
            <div class="side-user-name">@Model.UserName</div>
            <div class="side-user-email">@Model.UserEmail</div>
        </div>

        <a asp-page="/Login" class="menu-item">← Back to Login</a>

        <!-- ⚠️ This is NOT real logout. It just goes to Index. -->
        <a asp-page="/Index" class="menu-item menu-item-danger">Log out</a>
    </div>

    <!-- main content -->
    <div class="dashboard-cards">
        <!-- Scanner Card -->
        <div class="card" onclick="location.href='@Url.Page("/Scanner")'">
            <h3>Scanner</h3>
            <p>Click here to go to the Scan page</p>
        </div>
    </div>
</div>

<div id="successPopup" class="popup-message">
    Login Successful!
</div>

<script>
    // ----------------------------
    // ✅ Login success popup
    // ----------------------------
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('loggedIn') === 'true') {
        const popup = document.getElementById('successPopup');
        popup.classList.add('show');

        window.history.replaceState({}, document.title, window.location.pathname);

        setTimeout(() => {
            popup.style.animation = 'slideUp 0.5s ease-out forwards';
            setTimeout(() => {
                popup.classList.remove('show');
                popup.style.animation = '';
            }, 500);
        }, 2000);
    }

    // ----------------------------
    // ✅ Hamburger menu logic
    // ----------------------------
    const menuBtn = document.getElementById('menuBtn');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const sideMenu = document.getElementById('sideMenu');
    const menuOverlay = document.getElementById('menuOverlay');

    function openMenu() {
        sideMenu.classList.add('open');
        menuOverlay.style.display = 'block';
        setTimeout(() => menuOverlay.classList.add('show'), 0);
    }

    function closeMenu() {
        sideMenu.classList.remove('open');
        menuOverlay.classList.remove('show');
        setTimeout(() => menuOverlay.style.display = 'none', 200);
    }

    menuBtn.addEventListener('click', openMenu);
    closeMenuBtn.addEventListener('click', closeMenu);
    menuOverlay.addEventListener('click', closeMenu);

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
    });
</script>
